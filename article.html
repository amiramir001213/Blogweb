
<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>مقاله | وبلاگ من</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="description" content="مقاله در وبلاگ من">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
</head>

<body>

    <header class="site-header container">
        <a href="index.html" class="logo">وبلاگ من</a>
        <nav class="site-nav" id="main-nav">
            <a href="index.html">خانه</a>
            <a href="index.html#page=1">مقالات</a>
            <a href="#">درباره من</a>
            <a href="https://t.me/http_users" target="_blank" class="telegram-link">
                <span class="telegram-icon">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.0717 3.57277C21.8063 3.34026 21.4482 3.25452 21.1168 3.34026L2.83748 9.34026C2.39498 9.46725 2.09123 9.83027 2.01873 10.2866C1.95061 10.7428 2.13436 11.1764 2.50311 11.4153L6.57886 14.2053V19.9991C6.57886 20.4553 6.82936 20.8678 7.22561 21.0928C7.4186 21.1991 7.63873 21.2491 7.85323 21.2491C8.0771 21.2491 8.29685 21.1928 8.4961 21.0928L12.5719 18.9303L15.5781 21.5553C15.8622 21.8116 16.2396 21.9491 16.6296 21.9491C16.7156 21.9491 16.8081 21.9428 16.8969 21.9241C17.3781 21.8178 17.7781 21.5053 17.9656 21.0616L22.2781 4.56152C22.4031 4.23027 22.3281 3.8053 22.0717 3.57277ZM16.5594 6.18652L8.6156 13.4678L4.97686 10.9678L16.5594 6.18652ZM8.57611 19.2491V15.6928L10.7219 17.6241L8.57611 19.2491ZM16.6296 19.9491L9.41735 13.5116L20.6343 5.13027L16.6296 19.9491Z" fill="currentColor"/>
                    </svg>
                </span>
                تماس با من
            </a>
        </nav>
        <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-label="منوی موبایل">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <main class="site-main container">
        <!-- جزئیات مقاله -->
        <article id="article-content" class="post-detail fade-in">
            <a href="index.html" class="button back-button">◀ بازگشت به صفحه اصلی</a>
            <h1 id="article-title"></h1>
            <p id="article-meta" class="post-meta"></p>
            <div id="article-body" class="post-content"></div>
        </article>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <span>© ۱۴۰۳ وبلاگ امنیت وب</span>
                    <span>|</span>
                    <span>تمامی حقوق این وب‌سایت محفوظ است.</span>
                </div>
                <div class="footer-contact">
                    <a href="https://t.me/http_users" target="_blank" class="telegram-link">
                        <span class="telegram-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="var(--accent-color)" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22.0717 3.57277C21.8063 3.34026 21.4482 3.25452 21.1168 3.34026L2.83748 9.34026C2.39498 9.46725 2.09123 9.83027 2.01873 10.2866C1.95061 10.7428 2.13436 11.1764 2.50311 11.4153L6.57886 14.2053V19.9991C6.57886 20.4553 6.82936 20.8678 7.22561 21.0928C7.4186 21.1991 7.63873 21.2491 7.85323 21.2491C8.0771 21.2491 8.29685 21.1928 8.4961 21.0928L12.5719 18.9303L15.5781 21.5553C15.8622 21.8116 16.2396 21.9491 16.6296 21.9491C16.7156 21.9491 16.8081 21.9428 16.8969 21.9241C17.3781 21.8178 17.7781 21.5053 17.9656 21.0616L22.2781 4.56152C22.4031 4.23027 22.3281 3.8053 22.0717 3.57277ZM16.5594 6.18652L8.6156 13.4678L4.97686 10.9678L16.5594 6.18652ZM8.57611 19.2491V15.6928L10.7219 17.6241L8.57611 19.2491ZM16.6296 19.9491L9.41735 13.5116L20.6343 5.13027L16.6296 19.9491Z" fill="currentColor"/>
                            </svg>
                        </span>
                        <span>دسترسی به کانال تلگرام</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // اسکریپت صفحه مقاله
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // دریافت شناسه مقاله از پارامترهای URL
                const urlParams = new URLSearchParams(window.location.search);
                const postId = urlParams.get('id');
                
                if (!postId) {
                    window.location.href = 'index.html';
                    return;
                }
                
                // دریافت مقالات
                const response = await fetch('posts.json');
                if (!response.ok) throw new Error('خطا در دریافت مقالات');
                
                const posts = await response.json();
                const post = posts.find(p => p.id === postId);
                
                if (!post) {
                    window.location.href = 'index.html';
                    return;
                }
                
                // تنظیم عنوان صفحه
                document.title = post.title + ' | وبلاگ من';
                
                // نمایش اطلاعات مقاله
                const titleElement = document.getElementById('article-title');
                titleElement.innerHTML = `<mark>${post.title}</mark>`; // مارک دار کردن عنوان
                document.getElementById('article-meta').textContent = `تاریخ: ${post.date} | نویسنده: ${post.author}`;
                
                const contentContainer = document.getElementById('article-body');
                contentContainer.innerHTML = ''; // پاک کردن محتوای قبلی
                
                // اضافه کردن تصویر شاخص اگر وجود داشته باشد
                if (post.image) {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'post-featured-image';
                    
                    const img = document.createElement('img');
                    img.src = post.image;
                    img.alt = post.title;
                    img.loading = 'eager';
                    
                    imgContainer.appendChild(img);
                    contentContainer.appendChild(imgContainer);
                }
                
                // افزودن محتوای اصلی مقاله
                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'post-content-wrapper';
                
                // حذف تصاویر تکراری از محتوا اگر تصویر شاخص وجود دارد
                let content = post.content;
                if (post.image) {
                    // حذف اولین تگ img در محتوا اگر تصویر شاخص وجود دارد
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = content;
                    
                    const firstImg = tempDiv.querySelector('img');
                    if (firstImg && firstImg.src && firstImg.src.includes(post.image.split('/').pop())) {
                        firstImg.parentElement.removeChild(firstImg);
                    }
                    
                    content = tempDiv.innerHTML;
                }
                
                contentWrapper.innerHTML = content;
                contentContainer.appendChild(contentWrapper);
                
                // هایلایت کردن کلمات کلیدی
                highlightKeywords();
                
                // مدیریت رسانه‌ها
                handleMediaElements();
                
                // اضافه کردن دکمه اشتراک‌گذاری
                addShareButton(post);
                
                // مدیریت منوی موبایل
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                const mainNav = document.getElementById('main-nav');
                
                if (mobileMenuToggle) {
                    mobileMenuToggle.addEventListener('click', () => {
                        mainNav.classList.toggle('active');
                    });
                }
                
                // مدیریت ریسپانسیو بودن
                setupResponsiveHandling();

            } catch (error) {
                console.error('خطا:', error);
                alert('مشکلی در بارگذاری مقاله پیش آمد.');
                window.location.href = 'index.html';
            }
        });
        
        // تنظیم ریسپانسیو
        function setupResponsiveHandling() {
            const handleResize = () => {
                const width = window.innerWidth;
                const article = document.getElementById('article-content');
                
                if (width <= 480) {
                    article.classList.add('mobile-view');
                } else if (width <= 700) {
                    article.classList.add('tablet-view');
                    article.classList.remove('mobile-view');
                } else {
                    article.classList.remove('tablet-view', 'mobile-view');
                }
            };
            
            // اجرا در بارگذاری و تغییر اندازه پنجره
            handleResize();
            window.addEventListener('resize', handleResize);
        }
        
        // هایلایت کردن کلمات کلیدی
        function highlightKeywords() {
            // لیستی از کلمات کلیدی
            const keywords = ['HttpOnly', 'XSS', 'CSRF', 'Security', 'امنیت', 'کوکی', 'جلسه', 'حمله'];
            
            const content = document.getElementById('article-body');
            if (!content) return;
            
            // پیمایش در کل کلمات کلیدی
            keywords.forEach(keyword => {
                // ایجاد عبارت باقاعده برای پیدا کردن کلمات کلیدی
                const regex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                
                // پیدا کردن و هایلایت کردن کلمات کلیدی در محتوا
                content.querySelectorAll('p, li').forEach(el => {
                    if (!el.querySelector('code, pre, mark')) { // اگر شامل کد یا علامت‌گذاری قبلی نباشد
                        el.innerHTML = el.innerHTML.replace(regex, '<mark>$1</mark>');
                    }
                });
            });
        }
        
        // مدیریت رسانه‌ها در محتوای مقاله
        function handleMediaElements() {
            // لود تنبل (lazy loading) تصاویر
            document.querySelectorAll('#article-body img').forEach(img => {
                img.loading = 'lazy';
                
                // افزودن کلاس برای انیمیشن ظهور
                img.classList.add('lazy-image');
                
                // افزودن قابلیت بزرگنمایی با کلیک
                img.addEventListener('click', () => {
                    showImageViewer(img.src, img.alt);
                });
            });
            
            // افزودن قابلیت کپی به بلوک‌های کد
            document.querySelectorAll('#article-body pre').forEach(pre => {
                const codeBlock = pre.querySelector('code') || pre;
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-code-button';
                copyButton.textContent = 'کپی کد';
                copyButton.addEventListener('click', () => {
                    navigator.clipboard.writeText(codeBlock.textContent)
                        .then(() => {
                            const originalText = copyButton.textContent;
                            copyButton.textContent = 'کپی شد! ✓';
                            copyButton.style.backgroundColor = '#10b981'; // رنگ سبز موفقیت
                            setTimeout(() => {
                                copyButton.textContent = originalText;
                                copyButton.style.backgroundColor = '';
                            }, 2000);
                        })
                        .catch(err => console.error('خطا در کپی کردن:', err));
                });
                
                pre.style.position = 'relative';
                pre.appendChild(copyButton);
            });
        }
        
        // نمایش ویوئر تصویر
        function showImageViewer(src, alt) {
            // ایجاد یک لایه مودال برای نمایش تصویر
            const viewer = document.createElement('div');
            viewer.className = 'image-viewer';
            
            const img = document.createElement('img');
            img.src = src;
            img.alt = alt || 'تصویر بزرگ';
            
            const closeButton = document.createElement('button');
            closeButton.className = 'close-button';
            closeButton.innerHTML = '&times;';
            closeButton.setAttribute('aria-label', 'بستن');
            
            viewer.appendChild(img);
            viewer.appendChild(closeButton);
            
            document.body.appendChild(viewer);
            
            // جلوگیری از اسکرول صفحه هنگام باز بودن ویوئر
            document.body.style.overflow = 'hidden';
            
            // رویداد بستن ویوئر
            closeButton.addEventListener('click', () => {
                document.body.removeChild(viewer);
                document.body.style.overflow = '';
            });
            
            // بستن با کلیک بیرون از تصویر
            viewer.addEventListener('click', e => {
                if (e.target === viewer) {
                    document.body.removeChild(viewer);
                    document.body.style.overflow = '';
                }
            });
        }
        
        // اضافه کردن دکمه اشتراک‌گذاری
        function addShareButton(post) {
            const contentContainer = document.getElementById('article-body');
            
            // ایجاد باکس اشتراک‌گذاری
            const shareBox = document.createElement('div');
            shareBox.className = 'share-box';
            
            const shareText = document.createElement('p');
            shareText.textContent = 'این مقاله را به اشتراک بگذارید:';
            
            const shareBtns = document.createElement('div');
            shareBtns.className = 'share-buttons';
            
            // دکمه کپی لینک
            const copyLink = document.createElement('button');
            copyLink.className = 'share-btn copy-link';
            copyLink.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg><span>کپی لینک</span>';
            
            copyLink.addEventListener('click', () => {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    copyLink.querySelector('span').textContent = 'کپی شد!';
                    setTimeout(() => {
                        copyLink.querySelector('span').textContent = 'کپی لینک';
                    }, 2000);
                });
            });
            
            // دکمه تلگرام
            const telegramShare = document.createElement('a');
            telegramShare.className = 'share-btn telegram-share';
            telegramShare.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M22.0717 3.57277C21.8063 3.34026 21.4482 3.25452 21.1168 3.34026L2.83748 9.34026C2.39498 9.46725 2.09123 9.83027 2.01873 10.2866C1.95061 10.7428 2.13436 11.1764 2.50311 11.4153L6.57886 14.2053V19.9991C6.57886 20.4553 6.82936 20.8678 7.22561 21.0928C7.4186 21.1991 7.63873 21.2491 7.85323 21.2491C8.0771 21.2491 8.29685 21.1928 8.4961 21.0928L12.5719 18.9303L15.5781 21.5553C15.8622 21.8116 16.2396 21.9491 16.6296 21.9491C16.7156 21.9491 16.8081 21.9428 16.8969 21.9241C17.3781 21.8178 17.7781 21.5053 17.9656 21.0616L22.2781 4.56152C22.4031 4.23027 22.3281 3.8053 22.0717 3.57277ZM16.5594 6.18652L8.6156 13.4678L4.97686 10.9678L16.5594 6.18652ZM8.57611 19.2491V15.6928L10.7219 17.6241L8.57611 19.2491ZM16.6296 19.9491L9.41735 13.5116L20.6343 5.13027L16.6296 19.9491Z" fill="currentColor"/></svg><span>تلگرام</span>';
            telegramShare.href = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(post.title)}`;
            telegramShare.target = '_blank';
            telegramShare.rel = 'noopener noreferrer';
            
            shareBtns.appendChild(copyLink);
            shareBtns.appendChild(telegramShare);
            
            shareBox.appendChild(shareText);
            shareBox.appendChild(shareBtns);
            
            contentContainer.appendChild(shareBox);
        }
    </script>
</body>

</html>
